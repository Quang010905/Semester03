@using System.Linq
@using Semester03.Areas.Client.Models.ViewModels
@model object

@{
    IEnumerable<EventCardVm> events = null;

    if (Model is IEnumerable<EventCardVm> evs)
    {
        events = evs;
    }
    else if (Model is IEnumerable<dynamic> dyns)
    {
        events = dyns.Select(d => new EventCardVm
        {
            Id = (int?)(d?.Id ?? d?.EventId) ?? 0,
            Title = (string)(d?.Title ?? d?.EventName ?? ""),
            ShortDescription = (string)(d?.ShortDescription ?? d?.Description ?? d?.EventDescription ?? ""),
            StartDate = (DateTime?)(d?.StartDate ?? d?.EventStart ?? d?.NextShowtime),
            ImageUrl = (string)(d?.ImageUrl ?? d?.EventImg ?? d?.PosterUrl ?? "/images/event-placeholder.png")
        });
    }
    else
    {
        events = Enumerable.Empty<EventCardVm>();
    }
}

<div class="list-group small">
    @if (events.Any())
    {
        foreach (var e in events)
        {
            var title = e?.Title ?? "Event";
            var start = e?.StartDate.HasValue == true ? e.StartDate.Value.ToString("dd MMM yyyy HH:mm") : "";
            <a href="@Url.Action("Details", "Event", new { area = "Client", id = e?.Id })" class="list-group-item list-group-item-action">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="text-truncate" style="max-width:180px;">@title</div>
                    <small class="text-muted">@start</small>
                </div>
                @if (!string.IsNullOrWhiteSpace(e?.ShortDescription))
                {
                    <div class="small text-muted ps-2 pe-2">@e.ShortDescription</div>
                }
            </a>
        }
    }
    else
    {
        <div class="text-center text-muted small p-3">
            <div>No upcoming items 🔕</div>
            <div class="mt-2">
                <a href="@Url.Action("Index", "Event", new { area = "Client" })" class="btn btn-sm btn-outline-primary">See all events</a>
            </div>
        </div>
    }
</div>