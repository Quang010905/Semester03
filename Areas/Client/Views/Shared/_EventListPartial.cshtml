@using System.Linq
@using Semester03.Areas.Client.Models.ViewModels
@model IEnumerable<Semester03.Areas.Client.Models.ViewModels.EventCardVm>

<div class="list-group small">
    @{
        var now = DateTime.Now;
        var items = (Model ?? Enumerable.Empty<EventCardVm>())
        .Where(e => e.StartDate == null || e.StartDate >= now) // cho an toàn nếu StartDate null
        .OrderBy(e => e.StartDate ?? DateTime.MaxValue)
        .Take(6)
        .ToList();
    }

    @if (items.Any())
    {
        @foreach (var e in items)
        {
            var title = string.IsNullOrWhiteSpace(e.Title) ? "Event" : e.Title;
            var start = e.StartDate.HasValue ? e.StartDate.Value.ToString("dd MMM yyyy HH:mm") : "--";
            var img = string.IsNullOrWhiteSpace(e.ImageUrl)
            ? Url.Content("~/images/event-placeholder.png")
            : (e.ImageUrl.StartsWith("/") ? Url.Content("~" + e.ImageUrl) : Url.Content("~/images/events/" + e.ImageUrl));
            var detailUrl = Url.Action("Details", "Event", new { area = "Client", id = e.Id });

            <a href="@detailUrl" class="list-group-item list-group-item-action d-flex gap-3 py-3" aria-current="true">
                <img src="@img" alt="@title" style="width:84px; height:84px; object-fit:cover; border-radius:8px;" />
                <div class="d-flex flex-column w-100">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="me-2" style="min-width:0;">
                            <div class="fw-semibold text-truncate" style="max-width: calc(100% - 90px);">@title</div>
                        </div>
                        <small class="text-muted ms-2 text-nowrap">@start</small>
                    </div>

                    @if (!string.IsNullOrWhiteSpace(e.ShortDescription))
                    {
                        <div class="small text-muted mt-1 text-truncate" style="max-width:100%;">@e.ShortDescription</div>
                    }
                </div>
            </a>
        }
    }
    else
    {
        <div class="text-center text-muted small p-3">
            No upcoming events 🔕
        </div>
    }

    <div class="text-center mt-3">
        <a href="@Url.Action("Index", "Event", new { area = "Client" })" class="btn btn-outline-secondary btn-sm">
            View all events
        </a>
    </div>
</div>
