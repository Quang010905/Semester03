@model IEnumerable<Semester03.Areas.Client.Models.ViewModels.EventCardVm>
@using System
@using System.Linq

@{
    Func<string, string> Img = raw =>
    {
        if (string.IsNullOrWhiteSpace(raw))
            return Url.Content("~/images/event-placeholder.png");

        if (raw.StartsWith("http", StringComparison.OrdinalIgnoreCase))
            return raw;

        var s = raw.Replace("wwwroot/", "").TrimStart('~', '/')
                   .Replace(" ", "%20");

        if (s.StartsWith("Content", StringComparison.OrdinalIgnoreCase)
            || s.StartsWith("images", StringComparison.OrdinalIgnoreCase)
            || s.StartsWith("Admin/img", StringComparison.OrdinalIgnoreCase))
            return Url.Content("~/" + s);

        if (raw.StartsWith("/"))
            return Url.Content("~" + raw);

        return Url.Content("~/Content/Uploads/Events/" + s);
    };

    var now = DateTime.Now;
    var items = (Model ?? Enumerable.Empty<Semester03.Areas.Client.Models.ViewModels.EventCardVm>())
                    .Where(e => e.StartDate == null || e.StartDate >= now)
                    .OrderBy(e => e.StartDate ?? DateTime.MaxValue)
                    .Take(6)
                    .ToList();
}

<div class="mall-upcoming-card">
    <ul class="list-group list-group-flush mall-upcoming-list">

        @if (!items.Any())
        {
            <li class="list-group-item text-center text-muted py-4 bg-transparent border-0">
                No upcoming events at the moment.
            </li>
        }
        else
        {
            @foreach (var e in items)
            {
                var start = e.StartDate?.ToString("dd MMM yyyy HH:mm") ?? "--";
                var title = string.IsNullOrWhiteSpace(e.Title) ? "Event" : e.Title;

                <li class="list-group-item mall-upcoming-item border-0">
                    <a href="@Url.Action("Details", "Event", new { area = "Client", id = e.Id })"
                       class="d-flex gap-3 text-decoration-none align-items-center">
                        <div class="mall-upcoming-thumb-wrapper">
                            <img src="@Img(e.ImageUrl)" class="mall-upcoming-thumb" alt="@title" />
                        </div>

                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start">
                                <strong class="mall-upcoming-title text-truncate" title="@title">
                                    @title
                                </strong>
                                <small class="mall-upcoming-date text-nowrap ms-2">
                                    @start
                                </small>
                            </div>

                            @if (!string.IsNullOrWhiteSpace(e.ShortDescription))
                            {
                                <div class="mall-upcoming-desc text-muted small mt-1" title="@e.ShortDescription">
                                    @e.ShortDescription
                                </div>
                            }
                        </div>
                    </a>
                </li>
            }
        }
    </ul>
</div>

<style>
    .mall-upcoming-card {
        border-radius: 1.1rem;
        background: radial-gradient(circle at 0 0, #eff6ff, #ffffff);
        border: 1px solid rgba(226, 232, 240, 0.9);
        box-shadow: 0 16px 40px rgba(15, 23, 42, 0.12);
        overflow: hidden;
    }

    .mall-upcoming-list {
        border-radius: inherit;
    }

    .mall-upcoming-item {
        padding: .65rem .8rem;
        background-color: transparent;
        transition: background 0.16s ease, transform 0.12s ease, box-shadow 0.16s ease;
    }

        .mall-upcoming-item + .mall-upcoming-item {
            border-top: 1px dashed rgba(203, 213, 225, 0.9) !important;
        }

        .mall-upcoming-item > a {
            color: inherit;
        }

        .mall-upcoming-item:hover {
            background: #f9fafb;
            transform: translateY(-1px);
            box-shadow: 0 10px 26px rgba(15, 23, 42, 0.12);
        }

    .mall-upcoming-thumb-wrapper {
        flex-shrink: 0;
    }

    .mall-upcoming-thumb {
        border-radius: .9rem;
        width: 86px;
        height: 86px;
        object-fit: cover;
        box-shadow: 0 10px 24px rgba(15, 23, 42, 0.35);
    }

    .mall-upcoming-title {
        font-size: .92rem;
        font-weight: 600;
        color: #0f172a;
        max-width: 180px;
    }

    .mall-upcoming-date {
        font-size: .75rem;
        color: #6b7280;
    }

    .mall-upcoming-desc {
        font-size: .8rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
