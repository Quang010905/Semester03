@model IEnumerable<Semester03.Areas.Client.Models.ViewModels.EventCardVm>
@using System
@using System.Linq

@{
    Func<string, string> Img = raw =>
    {
        if (string.IsNullOrWhiteSpace(raw))
            return Url.Content("~/images/event-placeholder.png");

        if (raw.StartsWith("http", StringComparison.OrdinalIgnoreCase))
            return raw;

        var s = raw.Replace("wwwroot/", "").TrimStart('~', '/')
                   .Replace(" ", "%20");

        if (s.StartsWith("Content", StringComparison.OrdinalIgnoreCase)
            || s.StartsWith("images", StringComparison.OrdinalIgnoreCase)
            || s.StartsWith("Admin/img", StringComparison.OrdinalIgnoreCase))
            return Url.Content("~/" + s);

        if (raw.StartsWith("/"))
            return Url.Content("~" + raw);

        return Url.Content("~/Content/Uploads/Events/" + s);
    };

    var now = DateTime.Now;
    var items = (Model ?? Enumerable.Empty<Semester03.Areas.Client.Models.ViewModels.EventCardVm>())
                    .Where(e => e.StartDate == null || e.StartDate >= now)
                    .OrderBy(e => e.StartDate ?? DateTime.MaxValue)
                    .Take(6)
                    .ToList();
}

<div class="card shadow-sm rounded-4">
    <ul class="list-group list-group-flush">

        @if (!items.Any())
        {
            <li class="list-group-item text-center text-muted py-4">
                Hiện chưa có sự kiện sắp diễn ra.
            </li>
        }
        else
        {
            @foreach (var e in items)
            {
                var start = e.StartDate?.ToString("dd MMM yyyy HH:mm") ?? "--";

                <a href="@Url.Action("Details", "Event", new { area = "Client", id = e.Id })"
                   class="list-group-item list-group-item-action d-flex gap-3 py-3">

                    <img src="@Img(e.ImageUrl)" class="rounded-3"
                         style="width:84px;height:84px;object-fit:cover;box-shadow:0 8px 18px rgba(15,23,42,0.25);" />

                    <div class="w-100">
                        <div class="d-flex justify-content-between">
                            <strong class="text-truncate">
                                @e.Title
                            </strong>
                            <small class="text-muted">@start</small>
                        </div>

                        @if (!string.IsNullOrWhiteSpace(e.ShortDescription))
                        {
                            <div class="text-muted small text-truncate mt-1">
                                @e.ShortDescription
                            </div>
                        }
                    </div>

                </a>
            }
        }
    </ul>
</div>

<style>
    .list-group-item-action:hover {
        background: #f9fafb !important;
        transform: translateY(-1px);
        transition: .15s;
    }
</style>
