@using Semester03.Areas.Client.Models.ViewModels
@inject Semester03.Models.Repositories.EventRepository _eventRepo

@{
    ViewData["Title"] = "Events";
    ViewData["MallName"] = "ABCD Mall";
    Layout = "~/Areas/Client/Views/Shared/_LayoutClient.cshtml";

    Func<string, string> Img = raw =>
    {
        if (string.IsNullOrWhiteSpace(raw))
            return Url.Content("~/images/event-placeholder.png");

        if (raw.StartsWith("http", StringComparison.OrdinalIgnoreCase))
            return raw;

        var s = raw.Replace("wwwroot/", "").TrimStart('~', '/').Replace(" ", "%20");

        if (s.StartsWith("Content") || s.StartsWith("images") || s.StartsWith("Admin/img"))
            return Url.Content("~/" + s);

        if (raw.StartsWith("/"))
            return Url.Content("~" + raw);

        return Url.Content("~/Content/Uploads/Events/" + s);
    };

    var topEvents = await _eventRepo.GetUpcomingEventsAsync(6);
    topEvents ??= new List<EventCardVm>();
}

@section Styles {
    <style>

        /* ===== PAGE WRAPPER ===== */
        .events-home-wrapper {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ===== TITLE ===== */
        .events-title {
            font-weight: 800;
            letter-spacing: -0.5px;
            margin-bottom: 1.6rem;
            font-size: 2.2rem;
            text-transform: uppercase;
            text-align: center;
            background: linear-gradient(90deg,#0d6efd,#4f46e5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ===== CARD ===== */
        .event-card {
            border-radius: 1.1rem;
            overflow: hidden;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 12px 34px rgba(0,0,0,0.06);
            transition: .2s ease;
            position: relative;
        }

            .event-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 16px 40px rgba(0,0,0,0.1);
            }

            .event-card img {
                height: 220px;
                object-fit: cover;
                width: 100%;
                display: block;
            }

        /* ===== CARD BODY ===== */
        .event-card-body {
            padding: 1rem .9rem 1.2rem;
            text-align: center;
        }

        .event-title {
            font-size: 1.05rem;
            font-weight: 700;
            margin-bottom: .35rem;
            color: #111827;
            text-transform: capitalize;
        }

        /* ===== MALL LABEL ===== */
        .mall-label {
            font-size: .75rem;
            background: #eff6ff;
            padding: .25rem .65rem;
            border-radius: 999px;
            font-weight: 600;
            color: #1d4ed8;
            display: inline-block;
            margin-bottom: .4rem;
        }

        /* ===== DESCRIPTION ===== */
        .event-desc {
            color: #6b7280;
            font-size: .85rem;
            line-height: 1.35;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* EMPTY STATE */
        .empty-state {
            padding: 2.5rem;
            background: #f8fafc;
            border-radius: 1rem;
            text-align: center;
            border: 1px solid #e5e7eb;
            font-size: 1rem;
            color: #6b7280;
        }

    </style>
}

<div class="container py-5 events-home-wrapper">

    <h1 class="events-title">Upcoming Events</h1>

    @if (!topEvents.Any())
    {
        <div class="empty-state">
            <i class="bi bi-calendar-x fs-2 d-block mb-2"></i>
            No events available at the moment.
        </div>
    }
    else
    {
        <div class="row g-4">
            @foreach (var e in topEvents)
            {
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="event-card h-100">

                        <a href="@Url.Action("Details","Event",new { area="Client", id=e.Id })">
                            <img src="@Img(e.ImageUrl)" alt="@e.Title" />
                        </a>

                        <div class="event-card-body">
                            <div class="mall-label">@ViewData["MallName"]</div>

                            <a href="@Url.Action("Details","Event",new { area="Client", id=e.Id })"
                               class="text-decoration-none text-dark">
                                <div class="event-title text-truncate">@e.Title</div>
                            </a>

                            @if (!string.IsNullOrWhiteSpace(e.ShortDescription))
                            {
                                <p class="event-desc" title="@e.ShortDescription">
                                    @e.ShortDescription
                                </p>
                            }
                        </div>

                    </div>
                </div>
            }
        </div>
    }
</div>
