@model Semester03.Areas.Client.Models.ViewModels.EventDetailsVm
@using System

@{
    ViewData["Title"] = Model.Title;
    Layout = "~/Areas/Client/Views/Shared/_LayoutClient.cshtml";

    Func<string, string> Img = (raw) =>
    {
        if (string.IsNullOrWhiteSpace(raw))
            return Url.Content("~/images/event-placeholder.png");

        if (raw.StartsWith("http", StringComparison.OrdinalIgnoreCase))
            return raw;

        var s = raw.Replace("wwwroot/", "").TrimStart('~', '/');
        s = s.Replace(" ", "%20");

        if (s.StartsWith("Content", StringComparison.OrdinalIgnoreCase)
            || s.StartsWith("images", StringComparison.OrdinalIgnoreCase)
            || s.StartsWith("Admin/img", StringComparison.OrdinalIgnoreCase))
        {
            return Url.Content("~/" + s);
        }

        if (raw.StartsWith("/"))
            return Url.Content("~" + raw);

        return Url.Content("~/Content/Uploads/Events/" + s);
    };
}

@section Styles {
    <style>
        .event-page {
            max-width: 1200px;
            margin: 0 auto;
        }

        .event-main-card {
            background: #ffffff;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 12px 30px rgba(15,23,42,0.10);
            border: 1px solid #e5e7eb;
        }

        .event-main-img-wrapper {
            border-radius: .9rem;
            overflow: hidden;
            margin-bottom: 1.25rem;
        }

        .event-main-img {
            width: 100%;
            height: 360px;
            object-fit: cover;
            display: block;
        }

        .event-meta {
            color: #6b7280;
            font-size: .9rem;
        }

            .event-meta strong {
                color: #374151;
            }

        .event-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: .35rem;
        }

        /* Related */
        .related-title-section {
            font-weight: 600;
        }

        .related-card {
            border: 1px solid #e5e7eb;
            border-radius: .9rem;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(15,23,42,0.06);
            transition: transform .18s ease, box-shadow .18s ease;
            background: #fff;
        }

            .related-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 14px 32px rgba(15,23,42,0.12);
            }

            .related-card img {
                height: 140px;
                width: 100%;
                object-fit: cover;
            }

        .related-title {
            font-size: .98rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        /* Side info */
        .event-side-card {
            background: #ffffff;
            border-radius: 1rem;
            padding: 1.25rem;
            box-shadow: 0 10px 26px rgba(15,23,42,0.08);
            border: 1px solid #e5e7eb;
        }

            .event-side-card h6 {
                font-weight: 600;
            }

            .event-side-card p {
                font-size: .9rem;
                margin-bottom: .25rem;
            }

        .btn-register {
            font-weight: 600;
        }

        .badge-status {
            font-size: .75rem;
            padding: .25rem .55rem;
            border-radius: 999px;
        }

            .badge-status.active {
                background: #d1fae5;
                color: #047857;
            }

            .badge-status.inactive {
                background: #fee2e2;
                color: #b91c1c;
            }

        @@media (max-width: 991.98px) {
            .event-main-img {
                height: 270px;
            }
        }
    </style>
}

<div class="event-page container py-4">
    <div class="mb-3 d-flex justify-content-between align-items-center">
        <a href="@Url.Action("Index", "Event", new { area = "Client" })"
           class="btn btn-outline-secondary btn-sm">
            &larr; Back to events
        </a>

        <div>
            @if (Model.Status == 1)
            {
                <span class="badge-status active">Active</span>
            }
            else
            {
                <span class="badge-status inactive">Inactive</span>
            }
        </div>
    </div>

    <div class="row g-4">
        <!-- MAIN CONTENT -->
        <div class="col-lg-8">
            <div class="event-main-card">
                <div class="event-main-img-wrapper">
                    <img src="@Img(Model.ImageUrl)" alt="@Model.Title" class="event-main-img" />
                </div>

                <div class="d-flex align-items-start justify-content-between gap-2 mb-2">
                    <div>
                        <h1 class="event-title mb-1">@Model.Title</h1>
                        <div class="event-meta">
                            <i class="bi bi-calendar-event me-1"></i>
                            @Model.StartDate.ToString("dd MMM yyyy HH:mm")
                            @if (Model.EndDate.HasValue)
                            {
                                <span> — @Model.EndDate.Value.ToString("dd MMM yyyy HH:mm")</span>
                            }
                        </div>
                    </div>

                    <div class="text-end">
                        <div class="event-meta">
                            <strong>Slots:</strong> @Model.MaxSlot
                        </div>
                    </div>
                </div>

                <hr />

                <div class="mb-4">
                    @Html.Raw(Model.Description)
                </div>

                <div class="d-flex align-items-center gap-2">
                    <a href="@Url.Action("Index", "Event", new { area = "Client" })"
                       class="btn btn-outline-secondary">
                        &larr; Back to list
                    </a>
                </div>

                @if (Model.Related != null && Model.Related.Any())
                {
                    <hr class="my-4" />
                    <h5 class="related-title-section mb-3">Related events</h5>

                    <div class="row g-3">
                        @foreach (var r in Model.Related)
                        {
                            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                                <div class="card related-card h-100">
                                    <a href="@Url.Action("Details", "Event", new { area = "Client", id = r.Id })"
                                       class="d-block">
                                        <img src="@Img(r.ImageUrl)" class="card-img-top" alt="@r.Title" />
                                    </a>
                                    <div class="card-body p-2">
                                        <a href="@Url.Action("Details", "Event", new { area = "Client", id = r.Id })"
                                           class="text-decoration-none text-dark">
                                            <div class="related-title text-truncate">@r.Title</div>
                                        </a>
                                        <div class="small text-muted mb-1">
                                            @r.StartDate?.ToString("dd MMM yyyy") ?? "--"
                                        </div>
                                        <p class="small text-muted text-truncate mb-0">
                                            @r.ShortDescription
                                        </p>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>

        <!-- SIDEBAR -->
        <aside class="col-lg-4">
            <div class="event-side-card">
                <h6 class="mb-3">Event information</h6>

                <p>
                    <strong>Date: </strong>
                    @Model.StartDate.ToString("dd MMM yyyy")
                    @if (Model.EndDate.HasValue)
                    {
                        <span> — @Model.EndDate.Value.ToString("dd MMM yyyy")</span>
                    }
                </p>

                <p>
                    <strong>Time: </strong>
                    @Model.StartDate.ToString("HH:mm")
                    @if (Model.EndDate.HasValue)
                    {
                        <span> — @Model.EndDate.Value.ToString("HH:mm")</span>
                    }
                </p>

                <p><strong>Slots:</strong> @Model.MaxSlot</p>

                <p>
                    <strong>Status:</strong>
                    @(Model.Status == 1 ? "Active" : "Inactive")
                </p>

                <p>
                    <strong>Organizer:</strong>
                    @(Model.TenantPositionId != 0 ? Model.TenantPositionId.ToString() : "-")
                </p>

                <div class="d-grid mt-3">
                    <a href="@Url.Action("Register", "EventBooking", new { area = "Client", id = Model.Id })"
                       class="btn btn-success btn-register">
                        Register now
                    </a>
                </div>
            </div>
        </aside>
    </div>
</div>
